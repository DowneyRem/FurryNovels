##  评优算法
### 数据获取

从 Pixiv 可获取的数据中，与【众人喜爱的小说】有关的数据有一下三个

-   点击量 -  total_view - 小眼睛标志
-   收藏量 -  total_bookmarks -爱心标志
-   评论量 -  total_comments  

收藏率可由收藏量和点击量进行计算

- 收藏率 =  (收藏量/点击量)x100%

一般认为收藏率在  5% 以上的，即为一篇优质小说

### 数据处理

从上述数据中，计算推荐指数（recommend），达到门槛（推荐指数>=5）后，即可进行推荐

#### 第一部分：评论量

评论量是一个容易两极分化的数据，（作者与读者进行有效互动，评论量就会很多），有些小说的评论可能会超过30，但更多的甚至都不超过1个  
一般（非作者本人的）评论超过2个，即可认为这是一篇较为优质小说

对评论量取对数（而非取余数），则可以有效避免过多的评论造成的推荐指数过大

`log2(32) = 5` 而 `32/2 = 16`
```
import math

if comments >= 1: # 根据评论量增加推荐指数
	i = math.log2(comments)
	recommend += round(i, 1)
```

#### 第二部分：点击量与收藏率

下表中，首列为点击量，首行为收藏率，去掉首行首列的数据部分则为`numlist`

由点击量与收藏率则可以确定相应条件下的推荐指数

```
        1  2  3  4  5  6  7  8  9 10 
   0 [[-5 -4 -3 -2 -1  0  1  2  3  4]
 500  [-4 -3 -2 -1  0  1  2  3  4  5]
1000  [-3 -2 -1  0  1  2  3  4  5  6]
1500  [-2 -1  0  1  2  3  4  5  6  7]
2000  [-1  0  1  2  3  4  5  6  7  8]
2500  [ 0  1  2  3  4  5  6  7  8  9]
3000  [ 1  2  3  4  5  6  7  8  9 10]
3500  [ 2  3  4  5  6  7  8  9 10 11]
4000  [ 3  4  5  6  7  8  9 10 11 12]]
```
比如一篇 ` view=2365, bookmarks=203 即 rate=8.5 ` 的小说，推荐指数为 ` recommend=6 `

#### 第三部分：收藏率-矫正部分

在实际测试中，仅通过上述两个方法获得的推荐指数较小，故添加收藏率作为矫正数据

```
rate = 100 * bookmarks / view
x = view // 500
y = int(rate // 1) - 1
if x >= 9:
	x = 8
if y >= 10:
	y = 9
recommend += numlist[x,y] + y/2
```

### 最终评定

#### 直观表述

下表中，首列为点击量，首行为收藏率
以橙色部分（点击量 2000+，收藏率5%+）为基准
绿色部分，即推荐指数>=5的部分，是算法认为的优质小说（不考虑评论的前提下）

![评定表1](https://raw.githubusercontent.com/DowneyRem/FurryNovels/main/TelegramBot/Recommend.png)

还是这篇 ` view=2365, bookmarks=203 即 rate=8.5 ` 的小说  
推荐指数为 ` recommend= 6 + 3.5 = 9.5 `  

**基本上符合 Pixiv 用户对优秀的定义**



也可能将推荐指数调整为5.5
![评定表2](https://raw.githubusercontent.com/DowneyRem/FurryNovels/main/TelegramBot/Recommend2.png)




#### Q&A

Q1：为什么对阅读量较低的小说的收藏率要求比较高？  
A1：阅读量较低的小说，可能并非主流喜欢的小说  

Q2：为什么对阅读量较高的小说的收藏率要求比较低？  
A2：阅读量较高的小说，基本不可能收藏率过低。此处为 #第二部分 的问题 ，还有待调整

 

